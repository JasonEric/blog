package com.example.blog;import android.os.Handler;import android.os.Message;import android.support.v4.app.FragmentTransaction;import android.view.View;import android.webkit.WebView;import android.webkit.WebViewClient;import android.widget.Button;import android.widget.ProgressBar;import android.widget.Toast;import com.example.base.BaseActivity;import com.example.http.MyFinalHttp;import com.example.js.MyJavaScript;import com.example.service.BackgroudService.DownloadBinder;import com.example.utils.AppUtils;import com.example.view.PullToRefreshListView;import com.exapmle.adapter.ListViewAdapter;import com.exapmle.annotation.BindView;import net.tsz.afinal.http.AjaxCallBack;import net.tsz.afinal.http.AjaxParams;import net.tsz.afinal.http.HttpHandler;import java.io.File;import java.util.ArrayList;import java.util.List;public class MainActivity extends BaseActivity{		@BindView(id=R.id.listview)	private PullToRefreshListView listView;	@BindView(id=R.id.progressBar)	private ProgressBar progressBar;	@BindView(id=R.id.myweb) WebView webView;	@BindView(id=R.id.download,click="btnClick")Button button;	public FragmentTransaction fraTra = null;	private Handler handler;	public DownloadBinder binder;	private int progress;	HttpHandler<File>	handle;	@Override	public void initView() {		handler=new Handler(){			@Override			public void handleMessage(Message msg) {				progressBar.setProgress(msg.arg1);				super.handleMessage(msg);							}					};//		listView=(ListView)findViewById(R.id.listview);//		BackgroudService backgroudService=new BackgroudService();//		Intent intent=new Intent(MainActivity.this, BackgroudService.class);//		startService(intent);//		bindService(intent, conn, Service.BIND_AUTO_CREATE);	}//	ServiceConnection conn=new ServiceConnection() {////		@Override//		public void onServiceDisconnected(ComponentName name) {//			// TODO Auto-generated method stub////		}////		@Override//		public void onServiceConnected(ComponentName name, IBinder service) {//			// TODO Auto-generated method stub//			binder=(DownloadBinder)service;//			binder.start();////		}//	};	@Override	public boolean isFullScreen() {		return false;	}	@Override	public void setRootView() {		setContentView(R.layout.activity_main);	}	@Override	public void initData() {		List<String> list=new ArrayList<String>();		for(int i=0;i<5;i++){			list.add("items"+i);		}		listView.setAdapter(new ListViewAdapter(MainActivity.this, list,listView));		webView.getSettings().setJavaScriptEnabled(true);		// ????????????html????javascript?????????		webView.addJavascriptInterface(new MyJavaScript(this, handler),				"myjavascript");		// ????index.html		webView.setWebViewClient(new WebViewClient() {  			  		    @Override  		    public boolean shouldOverrideUrlLoading(WebView view, String url) {  		        return false;  		    }  		  @Override		public void onPageFinished(WebView view, String url) {			// TODO Auto-generated method stub			super.onPageFinished(view, url);			webView.loadUrl("javascript:(function(){"					+ "var objs = document.getElementsByTagName(\"img\"); "					+ "for(var i=0;i<objs.length;i++)  " + "{"					+ "    objs[i].onclick=function()  " + "    {  "					+ "        window.myjavascript.gotoActivity2(this.src);  "					+ "    }  " + "}" + "})()");		}		});  		webView.loadUrl("file:///android_asset/html5.html");		}	@Override	public boolean requireTitle() {		return false;	}	@Override	public int setMainView() {		return R.layout.activity_main;//		return 0;	}	public void btnClick(View view){		Toast.makeText(MainActivity.this,"???", Toast.LENGTH_LONG).show();		HttpHandler<File> httpHandler=MyFinalHttp.getInstance().download(				"http://b.hiphotos.baidu.com/image/pic/item/b8389b504fc2d562acd3bf97e41190ef77c66cf4.jpg",				new AjaxParams(),AppUtils.getMyCacheDir("") + "2.jpg",				true, 				new AjaxCallBack<File>() {					@Override					public void onLoading(long count, long current) {						progress = (int) (current / (float) count * 100);						Message message = handler.obtainMessage();						message.arg1 = progress;						handler.sendMessage(message);						System.out.println(progress);						super.onLoading(count, current);						Toast.makeText(MainActivity.this,"??????....", Toast.LENGTH_LONG).show();					}					@Override					public void onSuccess(File t) {						super.onSuccess(t);//						Toast.makeText(MainActivity.this,"??????...", Toast.LENGTH_LONG).show();					}				});//		httpHandler.cancel(true);	}			/**			 * AsyncHttpClient??????			 */	/*			AsyncHttpClient client=MyHttpClient.getHttpClient();			client.get(MainActivity.this, "http://www.sipedu.org/website/UploadFiles/ydjk/2014/11/2014111116150.zip", new FileAsyncHttpResponseHandler(MainActivity.this) {								@Override				public void onSuccess(int arg0, Header[] arg1, File arg2) {					// TODO Auto-generated method stub					System.out.println(arg2.length()+arg2.getParent()+arg2.getName());					progressBar.setProgress((int)(arg0/arg2.length()*100));					System.out.println((int)(arg0/arg2.length()*100));					arg2.canWrite();					arg2.renameTo(new File(arg2.getParent()+"/1.zip"));					arg2.canRead();					System.out.println("success"+arg2.length());				}				@Override				public void onFailure(int arg0, Header[] arg1, Throwable arg2, File arg3) {					// TODO Auto-generated method stub					System.out.println("fail"+arg2);									}			});			System.out.println("--------------------");			break;		default:			break;		}	}*/	@Override	protected void onPause() {		super.onPause();	}	/*public boolean onKeyDown(int keyCode, KeyEvent event) {		 if ((keyCode == KeyEvent.KEYCODE_BACK) && webView.canGoBack()) {		 webView.goBack();		 return true;	 }else {		finish();	}		return super.onKeyDown(keyCode, event);		 }*/}